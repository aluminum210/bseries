version='0.1'

def srcDir = 'src/main/lua'

task copySnippets(type:Copy, overwrite:true) {
  println("Reducing...")
  from("${srcDir}/bbag.lua",
    "${srcDir}/initGUI.lua",
    "${srcDir}/initHooks.lua",
    "${srcDir}/initEventHandler.lua",
    "${srcDir}/init.lua",
    "${srcDir}/main.lua")
  into "${buildDir}/tmp/${project.name}"
  def reducedFile = new File("${buildDir}/tmp/${project.name}/main.lua")
  eachFile{fileDetails ->  	  
  	println("Reducing " + fileDetails.name + ".")
    reducedFile << "\n--[[ " + fileDetails.name + " ]]--\n"
    reducedFile << fileDetails.file.text
    reducedFile << "\n--[[ end " + fileDetails.name + " ]]--\n"
    fileDetails.exclude()
  }
}

copySnippets.shouldRunAfter(clean)
copyResources.shouldRunAfter(clean)
distZip.mustRunAfter(copySnippets)
assemble.dependsOn(copySnippets)